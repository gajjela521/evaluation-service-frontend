<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Registration - Student Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/all.min.css">
</head>
<body class="bg-light">
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="index.html">
            <i class="fas fa-calendar-check me-2"></i>Exam Registration
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="index.html">Dashboard</a>
            <a class="nav-link" href="subjects.html">Browse Subjects</a>
            <a class="nav-link" href="../index.html">Home</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Student Info -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h5 class="mb-0">Welcome, <span id="student-name">Student</span></h5>
                            <p class="text-muted mb-0">Student ID: <span id="display-student-id">student123</span></p>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-outline-primary btn-sm" onclick="viewMyRegistrations()">
                                <i class="fas fa-list me-2"></i>My Registrations
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Exam Registration Form -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-plus-circle me-2"></i>Register for New Exam</h4>
                </div>
                <div class="card-body">
                    <form id="exam-registration-form">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="student-id" class="form-label">Student ID</label>
                                <input type="text" class="form-control" id="student-id" value="student123" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="class-id" class="form-label">Class *</label>
                                <select class="form-select" id="class-id" required>
                                    <option value="">Select Class</option>
                                    <option value="grade-9">Grade 9</option>
                                    <option value="grade-10">Grade 10</option>
                                    <option value="grade-11">Grade 11</option>
                                    <option value="grade-12">Grade 12</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="subject-id" class="form-label">Subject *</label>
                                <select class="form-select" id="subject-id" required disabled>
                                    <option value="">First select a class...</option>
                                </select>
                                <div id="subject-info" class="form-text"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="exam-date" class="form-label">Preferred Exam Date *</label>
                                <input type="date" class="form-control" id="exam-date" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="time-slot" class="form-label">Available Time Slots *</label>
                            <select class="form-select" id="time-slot" required disabled>
                                <option value="">Select subject and date first...</option>
                            </select>
                            <div id="slot-info" class="form-text"></div>
                        </div>

                        <div class="mb-3">
                            <label for="special-requirements" class="form-label">Special Requirements (Optional)</label>
                            <textarea class="form-control" id="special-requirements" rows="3"
                                      placeholder="Any accessibility needs or special accommodations..."></textarea>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-check me-2"></i>Register for Exam
                            </button>
                        </div>
                    </form>

                    <div id="registration-result" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- Available Subjects -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6><i class="fas fa-book me-2"></i>Available Subjects</h6>
                </div>
                <div class="card-body">
                    <div id="available-subjects">
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <strong>Mathematics</strong>
                                    <span class="badge bg-primary">4</span>
                                </div>
                                <small class="text-muted">Advanced calculus and algebra</small>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <strong>Physics</strong>
                                    <span class="badge bg-primary">3</span>
                                </div>
                                <small class="text-muted">Classical and modern physics</small>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <strong>Chemistry</strong>
                                    <span class="badge bg-primary">3</span>
                                </div>
                                <small class="text-muted">Organic and inorganic chemistry</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exam Calendar -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6><i class="fas fa-calendar me-2"></i>Upcoming Exam Dates</h6>
                </div>
                <div class="card-body">
                    <div id="exam-calendar">
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <strong>Mathematics</strong>
                                    <span class="badge bg-info">Dec 25</span>
                                </div>
                                <small class="text-muted">9:00 AM - 12:00 PM</small>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <strong>Physics</strong>
                                    <span class="badge bg-info">Dec 27</span>
                                </div>
                                <small class="text-muted">2:00 PM - 5:00 PM</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Help -->
            <div class="card">
                <div class="card-header">
                    <h6><i class="fas fa-question-circle me-2"></i>Need Help?</h6>
                </div>
                <div class="card-body">
                    <p class="small text-muted">
                        Having trouble registering for an exam? Contact the academic office:
                    </p>
                    <p class="small">
                        <i class="fas fa-envelope me-2"></i><a href="mailto:academic@school.edu">academic@school.edu</a><br>
                        <i class="fas fa-phone me-2"></i>+1 (555) 123-4567
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- My Registrations Modal -->
    <div class="modal fade" id="registrationsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-list me-2"></i>My Exam Registrations
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="student-registrations">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            You don't have any exam registrations yet. Register for your first exam using the form on the left!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="../js/api.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const classSelect = document.getElementById('class-id');
        const subjectSelect = document.getElementById('subject-id');
        const dateInput = document.getElementById('exam-date');
        const slotSelect = document.getElementById('time-slot');
        const form = document.getElementById('exam-registration-form');

        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        dateInput.min = today;

        // Load subjects when class is selected
        classSelect.addEventListener('change', async function() {
            const classId = this.value;
            subjectSelect.disabled = true;
            slotSelect.disabled = true;

            if (classId) {
                try {
                    // Simulate loading subjects (replace with actual API call)
                    subjectSelect.innerHTML = '<option value="">Loading subjects...</option>';

                    setTimeout(() => {
                        subjectSelect.innerHTML = `
                            <option value="">Select Subject</option>
                            <option value="math-101" data-duration="180" data-description="Advanced Mathematics">Mathematics (4 credits)</option>
                            <option value="phys-101" data-duration="120" data-description="Classical Physics">Physics (3 credits)</option>
                            <option value="chem-101" data-duration="150" data-description="General Chemistry">Chemistry (3 credits)</option>
                            <option value="eng-101" data-duration="90" data-description="English Literature">English (2 credits)</option>
                        `;
                        subjectSelect.disabled = false;
                    }, 1000);

                    // Uncomment when backend is ready:
                    // const subjects = await SubjectAPI.getSubjectsByClass(classId);
                    // subjectSelect.innerHTML = '<option value="">Select Subject</option>';
                    // subjects.forEach(subject => {
                    //     subjectSelect.innerHTML += `
                    //         <option value="${subject.id}" data-duration="${subject.duration}" data-description="${subject.description}">
                    //             ${subject.name} (${subject.credits} credits)
                    //         </option>
                    //     `;
                    // });
                    // subjectSelect.disabled = false;

                } catch (error) {
                    Utils.showError('subject-info', 'Failed to load subjects');
                }
            }
        });

        // Show subject info when selected
        subjectSelect.addEventListener('change', function() {
            const option = this.options[this.selectedIndex];
            if (option.value) {
                const duration = option.dataset.duration;
                const description = option.dataset.description;
                document.getElementById('subject-info').innerHTML = `
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>Duration: ${duration} minutes |
                        ${description}
                    </small>
                `;
                loadTimeSlots();
            }
        });

        // Load time slots when date changes
        dateInput.addEventListener('change', loadTimeSlots);

        // Load available time slots
        async function loadTimeSlots() {
            const subjectId = subjectSelect.value;
            const examDate = dateInput.value;

            if (subjectId && examDate) {
                try {
                    // Simulate loading time slots (replace with actual API call)
                    slotSelect.innerHTML = '<option value="">Loading time slots...</option>';

                    setTimeout(() => {
                        slotSelect.innerHTML = `
                            <option value="">Select Time Slot</option>
                            <option value="slot-1">9:00 AM - 12:00 PM (15 of 20 seats available)</option>
                            <option value="slot-2">2:00 PM - 5:00 PM (8 of 20 seats available)</option>
                            <option value="slot-3">6:00 PM - 9:00 PM (20 of 20 seats available)</option>
                        `;
                        slotSelect.disabled = false;
                    }, 1000);

                    // Uncomment when backend is ready:
                    // const slots = await ExamRegistrationAPI.getAvailableSlots(subjectId, examDate);
                    // slotSelect.innerHTML = '<option value="">Select Time Slot</option>';
                    // slots.forEach(slot => {
                    //     const available = slot.capacity - slot.registered;
                    //     slotSelect.innerHTML += `
                    //         <option value="${slot.id}" ${available <= 0 ? 'disabled' : ''}>
                    //             ${slot.startTime} - ${slot.endTime}
                    //             (${available} of ${slot.capacity} seats available)
                    //         </option>
                    //     `;
                    // });
                    // slotSelect.disabled = false;

                } catch (error) {
                    Utils.showError('slot-info', 'Failed to load time slots');
                }
            }
        }

        // Handle form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                studentId: document.getElementById('student-id').value,
                subjectId: subjectSelect.value,
                slotId: slotSelect.value,
                examDate: dateInput.value,
                specialRequirements: document.getElementById('special-requirements').value
            };

            Utils.showLoading('registration-result');

            try {
                // Simulate successful registration (replace with actual API call)
                setTimeout(() => {
                    const registrationId = 'REG-' + Date.now();
                    Utils.showSuccess('registration-result',
                        `Registration successful! Registration ID: ${registrationId}.
                         You will receive a confirmation email shortly.`
                    );
                    form.reset();
                    subjectSelect.disabled = true;
                    slotSelect.disabled = true;
                }, 2000);

                // Uncomment when backend is ready:
                // const result = await ExamRegistrationAPI.registerForExam(formData);
                // Utils.showSuccess('registration-result',
                //     `Registration successful! Registration ID: ${result.registrationId}.
                //      You will receive a confirmation email shortly.`
                // );

            } catch (error) {
                Utils.showError('registration-result',
                    `Registration failed: ${error.message}`
                );
            }
        });
    });

    // View student registrations
    async function viewMyRegistrations() {
        const modal = new bootstrap.Modal(document.getElementById('registrationsModal'));
        modal.show();

        // Simulate loading registrations (replace with actual API call)
        document.getElementById('student-registrations').innerHTML = `
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                You don't have any exam registrations yet. Register for your first exam using the form!
            </div>
        `;

        // Uncomment when backend is ready:
        // try {
        //     Utils.showLoading('student-registrations');
        //     const studentId = document.getElementById('student-id').value;
        //     const registrations = await ExamRegistrationAPI.getStudentRegistrations(studentId);
        //
        //     const registrationsHtml = registrations.map(reg => `
        //         <div class="card mb-3">
        //             <div class="card-body">
        //                 <div class="d-flex justify-content-between align-items-start">
        //                     <div>
        //                         <h6>${reg.subjectName}</h6>
        //                         <p class="text-muted mb-1">
        //                             <i class="fas fa-calendar me-2"></i>${Utils.formatDate(reg.examDate)}
        //                             <i class="fas fa-clock ms-3 me-2"></i>${reg.timeSlot}
        //                         </p>
        //                         <p class="mb-0">
        //                             <span class="badge bg-${reg.status === 'confirmed' ? 'success' : 'warning'}">
        //                                 ${reg.status.toUpperCase()}
        //                             </span>
        //                         </p>
        //                     </div>
        //                     <button class="btn btn-outline-danger btn-sm" onclick="cancelRegistration('${reg.id}')">
        //                         <i class="fas fa-times me-1"></i>Cancel
        //                     </button>
        //                 </div>
        //             </div>
        //         </div>
        //     `).join('');
        //
        //     document.getElementById('student-registrations').innerHTML = registrationsHtml;
        // } catch (error) {
        //     Utils.showError('student-registrations', 'Failed to load registrations');
        // }
    }

    // Cancel registration
    async function cancelRegistration(registrationId) {
        if (confirm('Are you sure you want to cancel this exam registration?')) {
            try {
                // Simulate cancellation (replace with actual API call)
                alert('Registration cancelled successfully!');
                viewMyRegistrations(); // Refresh the list

                // Uncomment when backend is ready:
                // await ExamRegistrationAPI.cancelRegistration(registrationId);
                // viewMyRegistrations(); // Refresh the list
            } catch (error) {
                alert('Failed to cancel registration: ' + error.message);
            }
        }
    }
</script>
</body>
</html>